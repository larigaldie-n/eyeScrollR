<!DOCTYPE html>
<html>
<head>
    <style>
        h1 {
            color: green;
        }
        #my-div {
            text-align: center;
            position: fixed;
            top: 0;
            width: 100%;
        }
        #foot {
            height:10000px;
        }
        #topleftpix {
            background-color: chartreuse;
            position: fixed;
            top: 0;
            left: 0;
            width: 1px;
            height: 1px;
            z-index: 10;
        }
        #topleftbox {
            background-color: blue;
            position: fixed;
            top: 0;
            left: 0;
            width: 10px;
            height: 10px;
            z-index: 5;
        }
       
    </style>
</head>
 
<body>
    <div id="topleftpix"></div>
    <div id="my-div">
      <h1>Calibration for eyeScrollR</h1>
      <b>NB: for this tool to work properly, please execute it on the monitor that will be used for eye-tracking. Furthermore, the monitor HAS to be the main display</b><br>
      <br><b>Please place the browser on the screen exactly as it is during the study, and refresh this page before you start</b><br>
      <br><b>It is strongly advised that you deactivate the smooth scrolling feature on your browser before you run the experiment</b><br>
      <br>If in doubt, only take the scroll_pixels value and do the rest by hand (see manual)<br>
      <p id="result_scroll"></p>
      <p id="result">Please scroll down a bit to calibrate</p>
    </div>

    <div id="foot"></div>
    
    <script type="text/javascript">
        window.addEventListener("wheel", handleWheel);
        window.addEventListener("scroll", handleScroll);
        window.addEventListener('beforeunload', forceTop);

        scrolls = [];

        function forceTop(e) {
            window.scrollTo(0, 0);
        }
 
        function handleWheel(e) {
            if (e.deltaY>0)
            {   
                scrolls.push(e.deltaY);
                scrolls.sort(function(a, b){return a - b});
                if (scrolls[0] < scrolls[scrolls.length -1])
                {
                    deltaY = scrolls.pop();
                    for (i=0; i<deltaY/scrolls[0]; i++)
                    {
                        scrolls.push(scrolls[0]);
                    }
                }
            }
            else
            {
                scrolls = [];
                document.getElementById('result').innerText = "Please scroll down to calibrate"
                document.getElementById('result_scroll').innerText = ""
                window.forceTop(0)
            }
        }

        function handleScroll(e) {

                if(scrolls.length > 0)
                {
                    if (typeof window.screenX !== 'undefined')
                    {
                        top_left_x = window.screenX * window.devicePixelRatio;
                        top_left_y = (window.screenY + (window.outerHeight - window.innerHeight))*window.devicePixelRatio;
                        bottom_right_x = (window.screenX + window.innerWidth)*window.devicePixelRatio;
                        bottom_right_y = (window.screenY + window.outerHeight)*window.devicePixelRatio;

                        // shift_right = (screen.width - (window.screenX + window.outerWidth))*window.devicePixelRatio;
                        // shift_right = screen.width - (shift_left + document.documentElement.clientWidth);
                        
                    }
                    else if (typeof window.screenLeft !== 'undefined')
                    {
                        top_left_x = window.screenLeft*window.devicePixelRatio;
                        top_left_y = (window.screenTop + (window.outerHeight - window.innerHeight))*window.devicePixelRatio;
                        bottom_right_x = (window.screenLeft + window.innerWidth)*window.devicePixelRatio;
                        bottom_right_y = (window.screenTop + window.outerHeight)*window.devicePixelRatio;

                        // shift_right = (screen.width - (window.screenLeft + window.outerWidth))*window.devicePixelRatio;
                        // shift_right = screen.width - (shift_left + document.documentElement.clientWidth);
                    }
                    else
                    {
                        top_left_x = -1;
                        top_left_y = -1;
                        bottom_right_x = -1;
                        bottom_right_y = -1;
                    }
                    document.getElementById('result_scroll').innerText = "scroll_pixels = " + Math.round(window.scrollY/scrolls.length)
                    document.getElementById('result').innerText = "scroll_calibrate(" + "screen_width = " + screen.width +  ", screen_height = " + screen.height + ", top_left_x = " + top_left_x + ", top_left_y = " + top_left_y + ", bottom_right_x = " + bottom_right_x + ", bottom_right_y = " + bottom_right_y + ", scroll_pixels = " + Math.round(window.scrollY/scrolls.length) + ")";                    
                }

        }
    </script>
</body>
 
</html>